# Нагрузочное тестирование

## Автоматизация

Для того, чтобы сделать нагрузочный тест и провести результаты, достаточно выполнить одну команду из Makefile: make gen-wrk-report 

Вот как это выглядит:

```
make gen-wrk-report 
# Тест на создание отзыва
#
wrk -t5 -c10 -d60m -s perf_test/post.lua http://127.0.0.1:8080/api/review > perf_test/outpost.txt  
#
cat perf_test/outpost.txt
Running 60m test @ http://127.0.0.1:8080/api/review
  5 threads and 10 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   274.30ms   66.47ms 920.87ms   69.17%
    Req/Sec     7.92      2.88    20.00     65.42%
  131249 requests in 60.00m, 109.65MB read
Requests/sec:     36.46
Transfer/sec:     31.19KB
#
# Тест на получение отзыва
#
wrk -t5 -c10 -d60m -s perf_test/get_after_post.lua http://127.0.0.1:8080/api/review/50000 > perf_test/outget.txt
#
cat perf_test/outget.txt
Running 60m test @ http://127.0.0.1:8080/api/review/50000
  5 threads and 10 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   266.32ms   65.82ms 758.23ms   68.88%
    Req/Sec     8.14      2.96    20.00     67.14%
  135188 requests in 60.00m, 112.94MB read
Requests/sec:     37.55
Transfer/sec:     32.12KB

```
Команда выполняет тесты из файлов post.lua и get_after_post.lua, записывает результаты в соответствующие текстовые файлы и выводит их содержимое в консоль. Таким образом тесты всегда можно посмотреть. При повторном запуске команды файлы перезапишутся.

## Анализ

1. **Создание отзыва**

36.46 запросов в секунду - достаточный показатель. Средняя задержка также удовлетворяет наш сервис. Этот запрос можно не оптимизировать.

2. **Получение отзыва**

Задержка ниже, чем у запроса на создание отзывов, также было сделано больше запросов на чтение, чем на запись. И в целом скорость запросов в секунду выше, но не намного. Из возможных причин такой статистики можно назвать сложность запроса, так как при чтении данных и дальнейшей их передаче происходит подсчет лайков/дизлайков отзыва.

## Оптимизация:

Показатели первого теста приемлемые.
Показатели второго теста можно улучшить. Например, денормализовать БД и упростить подсчет лайков, то есть считать их заранее.
