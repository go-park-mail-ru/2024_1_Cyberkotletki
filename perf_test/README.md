# Нагрузочное тестирование

## Автоматизация

Для того, чтобы сделать нагрузочный тест и провести результаты, достаточно выполнить одну команду из Makefile: make gen-wrk-report 

Вот как это выглядит:

```
make gen-wrk-report 
# Тест на создание отзыва
#
wrk -t5 -c10 -d60m -s perf_test/post.lua http://127.0.0.1:8080/api/review > perf_test/outpost.txt  
#
cat perf_test/outpost.txt
Running 60m test @ http://127.0.0.1:8080/api/review
  5 threads and 10 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   274.30ms   66.47ms 920.87ms   69.17%
    Req/Sec     7.92      2.88    20.00     65.42%
  131249 requests in 60.00m, 109.65MB read
Requests/sec:     36.46
Transfer/sec:     31.19KB
#
# Тест на получение отзыва
#
wrk -t5 -c10 -d60m -s perf_test/get_after_post.lua http://127.0.0.1:8080/api/review/50000 > perf_test/outget.txt
#
cat perf_test/outget.txt
Running 60m test @ http://127.0.0.1:8080/api/review/50000
  5 threads and 10 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency   266.32ms   65.82ms 758.23ms   68.88%
    Req/Sec     8.14      2.96    20.00     67.14%
  135188 requests in 60.00m, 112.94MB read
Requests/sec:     37.55
Transfer/sec:     32.12KB

```
Команда выполняет тесты из файлов post.lua и get_after_post.lua, записывает результаты в соответствующие текстовые файлы и выводит их содержимое в консоль. Таким образом тесты всегда можно посмотреть. При повторном запуске команды файлы перезапишутся.

## Анализ

1. **Создание отзыва**

Система обрабатывает 36.46 запросов в секунду при создании отзыва, что является приемлемым показателем для нашего сервиса. Средняя задержка составляет 274.30 ms, что также удовлетворяет наши требования. В связи с этим, текущий запрос на создание отзыва не требует дополнительной оптимизации.

2. **Получение отзыва**

При получении отзыва задержка составляет 266.32 ms, что ниже, чем у запроса на создание отзывов. Было выполнено больше запросов на чтение, чем на запись. В целом, скорость запросов в секунду выше, но не значительно. Одной из возможных причин такой статистики может быть сложность запроса, т.к. при чтении данных и дальнейшей их передаче происходит подсчет лайков/дизлайков отзыва.

## Оптимизация:

Производительность системы при создании отзыва удовлетворяет нашим требованиям. 
Однако, при получении отзыва наблюдается некоторое снижение производительности, что может быть связано с дополнительной сложностью запроса. Возможным решением для улучшения производительности может быть оптимизация запроса на чтение данных, например, путем денормализации базы данных и упрощения подсчета лайков/дизлайков отзыва.
